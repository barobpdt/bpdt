<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ… ë©”ì‹œì§€</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="chat.css">
    <link href="https://emoji-css.afeld.me/emoji.css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/js/common.js"></script>
</head>
<body>
<div class="container">
    <div class="chat-container page">
        <div class="chat-header">
            <h1>ì±„íŒ… ë©”ì‹œì§€</h1>
            <div class="user-info">
                <span class="user-name">ì‚¬ìš©ì</span>
                <span class="status online"></span>
            </div>
        </div>
        
        <div class="chat-messages" id="chat-messages">
            <!-- ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            <div class="message received">
                <div class="message-content">
                    <p>ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</p>
                    <span class="message-time">10:00</span>
                </div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <div class="chat-toolbar">
                <button id="emoji-button" class="toolbar-button">
                    <i class="far fa-smile"></i>
                </button>
                <label class="toolbar-button upload-clip">
                    <i class="fas fa-paperclip"></i>
                </label>
            </div>
            
            <div class="emoji-picker" id="emoji-picker">
                <div class="emoji-category">
                    <h4>í‘œì •</h4>
                    <div class="emoji-list">
                        <span class="emoji" data-emoji="ğŸ˜€">ğŸ˜€</span>
                        <span class="emoji" data-emoji="ğŸ˜ƒ">ğŸ˜ƒ</span>
                        <span class="emoji" data-emoji="ğŸ˜„">ğŸ˜„</span>
                        <span class="emoji" data-emoji="ğŸ˜">ğŸ˜</span>
                        <span class="emoji" data-emoji="ğŸ˜…">ğŸ˜…</span>
                        <span class="emoji" data-emoji="ğŸ˜‚">ğŸ˜‚</span>
                        <span class="emoji" data-emoji="ğŸ¤£">ğŸ¤£</span>
                        <span class="emoji" data-emoji="ğŸ˜Š">ğŸ˜Š</span>
                        <span class="emoji" data-emoji="ğŸ˜‡">ğŸ˜‡</span>
                        <span class="emoji" data-emoji="ğŸ™‚">ğŸ™‚</span>
                        <span class="emoji" data-emoji="ğŸ™ƒ">ğŸ™ƒ</span>
                        <span class="emoji" data-emoji="ğŸ˜‰">ğŸ˜‰</span>
                        <span class="emoji" data-emoji="ğŸ˜Œ">ğŸ˜Œ</span>
                        <span class="emoji" data-emoji="ğŸ˜">ğŸ˜</span>
                        <span class="emoji" data-emoji="ğŸ¥°">ğŸ¥°</span>
                    </div>
                </div>
                <div class="emoji-category">
                    <h4>ë™ë¬¼</h4>
                    <div class="emoji-list">
                        <span class="emoji" data-emoji="ğŸ¶">ğŸ¶</span>
                        <span class="emoji" data-emoji="ğŸ±">ğŸ±</span>
                        <span class="emoji" data-emoji="ğŸ­">ğŸ­</span>
                        <span class="emoji" data-emoji="ğŸ¹">ğŸ¹</span>
                        <span class="emoji" data-emoji="ğŸ°">ğŸ°</span>
                        <span class="emoji" data-emoji="ğŸ¦Š">ğŸ¦Š</span>
                        <span class="emoji" data-emoji="ğŸ»">ğŸ»</span>
                        <span class="emoji" data-emoji="ğŸ¼">ğŸ¼</span>
                        <span class="emoji" data-emoji="ğŸ¨">ğŸ¨</span>
                        <span class="emoji" data-emoji="ğŸ¯">ğŸ¯</span>
                        <span class="emoji" data-emoji="ğŸ¦">ğŸ¦</span>
                        <span class="emoji" data-emoji="ğŸ®">ğŸ®</span>
                        <span class="emoji" data-emoji="ğŸ·">ğŸ·</span>
                        <span class="emoji" data-emoji="ğŸ¸">ğŸ¸</span>
                        <span class="emoji" data-emoji="ğŸµ">ğŸµ</span>
                    </div>
                </div>
                <div class="emoji-category">
                    <h4>ìŒì‹</h4>
                    <div class="emoji-list">
                        <span class="emoji" data-emoji="ğŸ">ğŸ</span>
                        <span class="emoji" data-emoji="ğŸ">ğŸ</span>
                        <span class="emoji" data-emoji="ğŸŠ">ğŸŠ</span>
                        <span class="emoji" data-emoji="ğŸ‹">ğŸ‹</span>
                        <span class="emoji" data-emoji="ğŸŒ">ğŸŒ</span>
                        <span class="emoji" data-emoji="ğŸ‰">ğŸ‰</span>
                        <span class="emoji" data-emoji="ğŸ‡">ğŸ‡</span>
                        <span class="emoji" data-emoji="ğŸ“">ğŸ“</span>
                        <span class="emoji" data-emoji="ğŸˆ">ğŸˆ</span>
                        <span class="emoji" data-emoji="ğŸ’">ğŸ’</span>
                        <span class="emoji" data-emoji="ğŸ‘">ğŸ‘</span>
                        <span class="emoji" data-emoji="ğŸ¥­">ğŸ¥­</span>
                        <span class="emoji" data-emoji="ğŸ">ğŸ</span>
                        <span class="emoji" data-emoji="ğŸ¥¥">ğŸ¥¥</span>
                        <span class="emoji" data-emoji="ğŸ¥">ğŸ¥</span>
                    </div>
                </div>
            </div>
            
            <div class="chat-input-wrapper">
                <textarea id="message-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." rows="1"></textarea>
                <button id="send-button">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            
            <div class="file-preview" id="file-preview">
                <!-- ì—…ë¡œë“œëœ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>
    
	<div class="upload-container page">    
		<div class="upload-area" id="uploadArea">
			<div class="upload-icon">ğŸ“</div>
			<div class="upload-text">íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
			<input type="file" class="file-input" id="fileInput" multiple>
		</div>

		<div class="file-list" id="fileList"></div>
		<div class="progress-container" id="uploadProgress"></div>

		<div class="button-group">
			<button class="button upload-button" id="uploadButton">ì—…ë¡œë“œ</button>
			<button class="button clear-button" id="clearButton">ì´ˆê¸°í™”</button>
			<span style="flex:1"></span>
			<button class="button clear-button" id="cancleButton">ì·¨ì†Œ</button>
		</div>
    </div>
</div>

    <script src="/js/chat.js"></script>
   
    <script>
		const ws=websocketConnect('ws://localhost:8092/chat')
		const upload=wsChunkUploadFiles(ws)
		
		$(document).ready(function() {
			initChat()
			initUpload()
			togglePage('chat')
			$('.toolbar-button.upload-clip').on('click', ()=>togglePage('upload'))
			$('#cancleButton').on('click', ()=>togglePage('chat'))
			$('#uploadButton').on('click', ()=>uploadStart())
			
		})
		const togglePage = (name) => {
			$('.container').find('.page').each((n,el) => $(el).hide())
			$('.container').find('.'+name+'-container').show()
		}
		const uploadStart = () => {
			upload.start(pageInfo.files)
		}
		
        
        pageInfo.closeMode = 'close'
        pageInfo.wsCallback = function(header, data) {
            console.log("@@ websocket callback => header=="+header, data )
            var pos = header.indexOf('\r\n')
            if( pos==-1) return console.log("@@ websocket í—¤ë” ì˜¤ë¥˜")
            if( header.charAt(0)!='@' ) return console.log("@@ websocket í—¤ë” íƒ€ì… ì‹œì‘ ì˜¤ë¥˜")
            const line = header.substr(1,pos)
            const info = header.substr(pos+2)
            const a=line.split('::') // íƒ€ì…, ì˜¤ë¥˜ì½”ë“œ
            const b=info.split('::') // ë°ì´í„°í¬ê¸°, ìš”ì²­íƒ€ì…, ê²°ê³¼íƒ€ì…, ê²°ê³¼ì •ë³´
            // ${size},${requestType},${resultType},${resultInfo}
            const type = a[0]
			console.log('@@ web socket type=='+type)
            if( type=='req_login' ) {
                ws.sendData('req_login','',{id:'a',passwd:'b'})
            }
            if(type=='res_login' ) {
				ws.sendData('req_rommInfo','',{id:'a',passwd:'b'})
            }
        }
    </script>
	
	<style>
		.upload-clip {
			cursor:pointer;
		}
	</style>
</body>
</html> 