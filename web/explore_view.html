<!DOCTYPE html>
<html>
<head>
	<title>File Explorer</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="/js/jquery.js"></script>
	<script src="/js/common.js"></script>
	
	<script src="/js/slick/jquery.event.drag-2.3.0.js"></script>
	<script src="/js/slick/slick.core.js"></script>
	<script src="/js/slick/slick.grid.js"></script>
	<script src="/js/slick/slick.dataview.js"></script>
	<link rel="stylesheet" href="/js/slick/slick-default-theme.css" type="text/css"/>
	<link rel="stylesheet" href="/js/slick/slick.grid.css" type="text/css"/>
<style>
		/* ì „ì²´ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ */
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
			overflow: hidden;
		}
		
		/* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
		.main-container {
			display: flex;
			flex-direction: column;
			height: 100vh;
			width: 100%;
		}
		
		/* íˆ´ë°” ì˜ì—­ */
		.toolbar {
			padding: 10px;
			background: #f8f9fa;
			border-bottom: 1px solid #ddd;
			flex-shrink: 0;
			display: flex;
			align-items: center;
			gap: 10px;
		}
		
		.toolbar button {
			margin-right: 5px;
			padding: 5px 10px;
		}

		.filter-input {
			padding: 5px 10px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 12px;
			width: 200px;
			margin-left: auto;
		}

		.filter-input:focus {
			outline: none;
			border-color: #80bdff;
			box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
		}
		
		/* ê²½ë¡œ í‘œì‹œ ì˜ì—­ */
		.path-breadcrumb {
			padding: 10px;
			background: #fff;
			border-bottom: 1px solid #ddd;
			flex-shrink: 0;
			overflow-x: auto;
			white-space: nowrap;
		}
		
		/* ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ */
		.grid-container {
			flex: 1;
			position: relative;
			overflow: hidden;
			font-size: 12px;
			min-height: 0; /* Flexbox ë‚´ì—ì„œ ì˜¤ë²„í”Œë¡œìš°ê°€ ì‘ë™í•˜ë„ë¡ ì„¤ì • */
		}
		
		/* ê·¸ë¦¬ë“œ í—¤ë” ìŠ¤íƒ€ì¼ */
		.slick-header-column {
			background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
			border-right: 1px solid #dee2e6;
			border-bottom: 1px solid #dee2e6;
			padding: 8px 12px;
			font-weight: 600;
			color: #495057;
			text-align: left;
			font-size: 13px;
			transition: background-color 0.2s ease;
			position: relative;
		}

		.slick-sortable:hover {
			background: linear-gradient(to bottom, #e9ecef, #dee2e6);
		}

		.slick-header-column-sorted {
			font-style: normal;
			cursor: pointer;
		}

		.slick-header-column-sorted.slick-sortable:active {
			background: linear-gradient(to bottom, #dee2e6, #ced4da);
		}

		/* ì •ë ¬ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
		.slick-sort-indicator {
			display: inline-block;
			width: 0;
			height: 0;
			margin: 5px;
			vertical-align: middle;
			border-left: 4px solid transparent;
			border-right: 4px solid transparent;
		}

		.slick-sort-indicator-asc {
			border-bottom: 4px solid #6c757d;
		}

		.slick-sort-indicator-desc {
			border-top: 4px solid #6c757d;
		}

		/* ì»¬ëŸ¼ ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ ìŠ¤íƒ€ì¼ */
		.slick-resizable-handle {
			position: absolute;
			right: 0;
			top: 0;
			bottom: 0;
			width: 5px;
			cursor: col-resize;
			background: transparent;
		}

		.slick-resizable-handle:hover {
			background: rgba(0, 0, 0, 0.1);
		}
		
		.slick-row {
			border-bottom: 1px solid #eee;
		}
		
		.slick-row:hover {
			background-color: #f0f0f0;
		}
		
		.file-icon {
			width: 16px;
			height: 16px;
			margin-right: 5px;
			vertical-align: middle;
		}
		
		.folder-icon {
			color: #ffd700;
		}
		
		.file-icon {
			color: #666;
		}
		
		/* ë°˜ì‘í˜• ì„¤ì • */
		@media (max-width: 768px) {
			.toolbar button {
				padding: 8px 12px;
				margin-bottom: 5px;
			}
			
			.path-breadcrumb {
				font-size: 14px;
			}
		}

		.context-menu {
			position: fixed;
			background: white;
			border: 1px solid #e0e0e0;
			border-radius: 8px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			padding: 8px 0;
			z-index: 1000;
			min-width: 180px;
			font-size: 13px;
		}

		.context-menu-item {
			padding: 8px 16px;
			cursor: pointer;
			display: flex;
			align-items: center;
			color: #333;
			transition: all 0.2s ease;
		}

		.context-menu-item:hover {
			background-color: #f5f5f5;
			color: #1976d2;
		}

		.context-menu-item:active {
			background-color: #e3f2fd;
		}

		.context-menu-separator {
			height: 1px;
			background-color: #e0e0e0;
			margin: 8px 0;
		}

		.context-menu-item[data-action="open"]::before {
			content: "ğŸ“‚";
			margin-right: 8px;
		}

		.context-menu-item[data-action="rename"]::before {
			content: "âœï¸";
			margin-right: 8px;
		}

		.context-menu-item[data-action="delete"]::before {
			content: "ğŸ—‘ï¸";
			margin-right: 8px;
		}

		/* ì„ íƒëœ í–‰ ìŠ¤íƒ€ì¼ */
		.slick-row.selected {
			background-color: #e3f2fd !important;
		}
		
		.slick-row.selected:hover {
			background-color: #bbdefb !important;
		}
	</style>
</head>
<body>
	<div class="main-container">
		<div class="toolbar">
			<button onclick="navigateUp()">Up</button>
			<button onclick="refreshGrid()">Refresh</button>
			<button onclick="createNewFolder()">New Folder</button>
			<input type="text" class="filter-input" placeholder="Filter..." id="gridFilter">
		</div>
		<div class="path-breadcrumb" id="pathBreadcrumb">
			/root
		</div>
		<div id="grid" class="grid-container"></div>
	</div>
	
	<script>
		// ì „ì—­ ë³€ìˆ˜ ì„ ì–¸
		let currentPath = '/root';
		let grid;
		let dataView;
		let data = [];

		// ì»¬ëŸ¼ ì •ì˜
		const columns = [
			{ id: "name", name: "Name", field: "name", sortable: true, width: 300, resizable: true,
			  formatter: function(row, cell, value, columnDef, node) {
				  const icon = node.type === 'folder' ? 'ğŸ“' : 'ğŸ“„';
				  return '<span class="'+node.type+'-icon">'+icon+'</span> '+value;
			  }
			},
			{ id: "size", name: "Size", field: "size", cssClass: "text_center", sortable: true, width: 100, resizable: true },
			{ id: "modified", name: "Modified", field: "modified", cssClass: "text_center", sortable: true, width: 150, resizable: true },
			{ id: "type", name: "Type", field: "type", cssClass: "text_center", sortable: true, width: 100, resizable: true }
		];

		// ê·¸ë¦¬ë“œ ì˜µì…˜
		const options = {
			enableCellNavigation: true,
			enableColumnReorder: false,
			multiColumnSort: false,
			rowHeight: 30,
			headerRowHeight: 30,
			forceFitColumns: true,
			syncColumnCellResize: true,
			enableTextSelectionOnCells: false,
			enableColumnResize: true,
			enableRowSelection: true
		};

		// ê·¸ë¦¬ë“œ ì´ˆê¸°í™” í•¨ìˆ˜
		function initGrid() {
			try {
				// ì´ˆê¸° ë°ì´í„° ì„¤ì •
				data = [
					{ id:"k1", name: "Documents", type: "folder", size: "-", modified: "2024-04-22 10:00" },
					{ id:"k2", name: "Pictures", type: "folder", size: "-", modified: "2024-04-22 09:30" },
					{ id:"k3", name: "report.pdf", type: "file", size: "1.2MB", modified: "2024-04-21 15:45" },
					{ id:"k4", name: "data.xlsx", type: "file", size: "2.5MB", modified: "2024-04-20 11:20" }
				];
				
				// Slick ê°ì²´ê°€ ì •ì˜ë˜ì—ˆëŠ”ì§€ í™•ì¸
				if (typeof Slick === 'undefined') {
					throw new Error("SlickGrid library not loaded properly");
				}
				
				// DataView ì´ˆê¸°í™”
				dataView = new Slick.Data.DataView({
					groupItemMetadataProvider: null,
					inlineFilters: true
				});
				dataView.setItems(data);
				
				// í•„í„° í•¨ìˆ˜ ì„¤ì •
				dataView.setFilter(function(item) {
					const filterText = $("#gridFilter").val().toLowerCase();
					if (!filterText) return true;
					
					return (
						item.name.toLowerCase().includes(filterText) ||
						item.type.toLowerCase().includes(filterText) ||
						item.size.toLowerCase().includes(filterText) ||
						item.modified.toLowerCase().includes(filterText)
					);
				});
				
				// ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
				grid = new Slick.Grid("#grid", dataView, columns, options);
				
				// í–‰ ì„ íƒ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
				grid.onClick.subscribe(function(e, args) {
					if (args.row >= 0) {
						// ëª¨ë“  í–‰ì˜ ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
						$('.slick-row').removeClass('selected');
						
						// í´ë¦­í•œ í–‰ ì„ íƒ
						$(e.target).closest('.slick-row').addClass('selected');
					}
				});
				
				// ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
				grid.onContextMenu.subscribe(function(e, args) {
					e.preventDefault();
					const item = dataView.getItem(args.row);
					
					// ê¸°ì¡´ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì œê±°
					$('.context-menu').remove();
					
					// ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ìƒì„±
					const menu = $('<div class="context-menu"></div>');
					
					// ë©”ë‰´ í•­ëª© ì¶”ê°€
					menu.append('<div class="context-menu-item" data-action="open">ì—´ê¸°</div>');
					menu.append('<div class="context-menu-item" data-action="rename">ì´ë¦„ ë³€ê²½</div>');
					menu.append('<div class="context-menu-separator"></div>');
					menu.append('<div class="context-menu-item" data-action="delete">ì‚­ì œ</div>');
					
					// ë©”ë‰´ ìœ„ì¹˜ ì„¤ì •
					menu.css({
						top: e.pageY,
						left: e.pageX
					});
					
					// ë©”ë‰´ í‘œì‹œ
					$('body').append(menu);
					
					// ë©”ë‰´ í•­ëª© í´ë¦­ ì´ë²¤íŠ¸
					menu.on('click', '.context-menu-item', function() {
						const action = $(this).data('action');
						switch(action) {
							case 'open':
								if (item.type === 'folder') {
									navigateToFolder(item.name);
								}
								break;
							case 'rename':
								const newName = prompt('ìƒˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', item.name);
								if (newName) {
									item.name = newName;
									dataView.updateItem(item.id, item);
									grid.render();
								}
								break;
							case 'delete':
								if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
									dataView.deleteItem(item.id);
									grid.render();
								}
								break;
						}
						menu.remove();
					});
					
					// ë‹¤ë¥¸ ê³³ í´ë¦­ì‹œ ë©”ë‰´ ì œê±°
					$(document).one('click', function() {
						menu.remove();
					});
				});
				
				// í•„í„° ì…ë ¥ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
				$("#gridFilter").on("input", function() {
					dataView.refresh();
					grid.render();
				});
				
				// ì •ë ¬ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
				grid.onSort.subscribe(function(e, args) { 
					const field = args.sortCol.field;
					dataView.sort(function(a, b) {
						const sign = args.sortAsc ? 1 : -1;
						const valueA = a[field];
						const valueB = b[field];
						const result = (valueA < valueB ? -1 : (valueA > valueB ? 1 : 0)) * sign;
						if (result !== 0) {
							return result;
						}
					}) 
					grid.invalidate();
					grid.render();
				});
				
				// ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
				grid.onDblClick.subscribe(function(e, args) {
					if (args.row >= 0 && args.row < dataView.getLength()) {
						const item = dataView.getItem(args.row);
						if (item && item.type === 'folder') {
							navigateToFolder(item.name);
						}
					}
				});
				
				// ê·¸ë¦¬ë“œ ë Œë”ë§
				grid.render();
				
				// ì»¬ëŸ¼ ìë™ ì¡°ì •
				grid.autosizeColumns();
				$('.slick-viewport').css('overflow-x', 'hidden');
				
				console.log("Grid initialized successfully");
			} catch (error) {
				console.error("Error initializing grid:", error);
				alert("Error initializing grid: " + error.message);
			}
		}

		// ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
		function loadData(path) {
			try {
				return;
				// This is where you would typically make an API call to get the folder contents
				// For demo purposes, we'll use sample data
				data = [
					{ id:"k1", name: "Documents", type: "folder", size: "-", modified: "2024-04-22 10:00" },
					{ id:"k2", name: "Pictures", type: "folder", size: "-", modified: "2024-04-22 09:30" },
					{ id:"k3", name: "report.pdf", type: "file", size: "1.2MB", modified: "2024-04-21 15:45" },
					{ id:"k4", name: "data.xlsx", type: "file", size: "2.5MB", modified: "2024-04-20 11:20" }
				];
				
				if (dataView) {
					dataView.setItems(data);
					updateBreadcrumb();
				} else {
					console.error("DataView not initialized");
				}
			} catch (error) {
				console.error("Error loading data:", error);
				alert("Error loading data: " + error.message);
			}
		}

		// í´ë” íƒìƒ‰ í•¨ìˆ˜
		function navigateToFolder(folderName) {
			currentPath = currentPath + '/' + folderName;
			loadData(currentPath);
		}

		// ìƒìœ„ í´ë”ë¡œ ì´ë™ í•¨ìˆ˜
		function navigateUp() {
			if (currentPath !== '/root') {
				currentPath = currentPath.substring(0, currentPath.lastIndexOf('/'));
				loadData(currentPath);
			}
		}

		// ê·¸ë¦¬ë“œ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
		function refreshGrid() {
			loadData(currentPath);
		}

		// ìƒˆ í´ë” ìƒì„± í•¨ìˆ˜
		function createNewFolder() {
			const folderName = prompt("Enter folder name:");
			if (folderName) {
				// Here you would typically make an API call to create the folder
				alert(`Folder "${folderName}" would be created here`);
			}
		}

		// ê²½ë¡œ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
		function updateBreadcrumb() {
			const parts = currentPath.split('/').filter(p => p);
			let html = '<span style="cursor: pointer" onclick="navigateToRoot()">/root</span>';
			let path = '';
			
			parts.forEach(part => {
				path += '/' + part;
				html += ` / <span style="cursor: pointer" onclick="navigateToPath('${path}')">${part}</span>`;
			});
			
			document.getElementById('pathBreadcrumb').innerHTML = html;
		}

		// ë£¨íŠ¸ í´ë”ë¡œ ì´ë™ í•¨ìˆ˜
		function navigateToRoot() {
			currentPath = '/root';
			loadData(currentPath);
		}

		// íŠ¹ì • ê²½ë¡œë¡œ ì´ë™ í•¨ìˆ˜
		function navigateToPath(path) {
			currentPath = path;
			loadData(currentPath);
		}

		// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
		$(document).ready(function() {
			try {
				// SlickGrid ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
				if (typeof Slick === 'undefined') {
					console.error("SlickGrid library not loaded. Waiting for it to load...");
					// ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
					setTimeout(function() {
						if (typeof Slick !== 'undefined') {
							initGrid();
							// loadData(currentPath);
						} else {
							alert("Failed to load SlickGrid library. Please check your internet connection and try again.");
						}
					}, 1000);
				} else {
					initGrid();
					// loadData(currentPath);
				}
			} catch (error) {
				console.error("Error during initialization:", error);
				alert("Error during initialization: " + error.message);
			}
		});
	</script>
</body>
</html> 